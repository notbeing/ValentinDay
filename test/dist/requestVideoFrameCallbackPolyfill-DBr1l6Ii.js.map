{"version":3,"file":"requestVideoFrameCallbackPolyfill-DBr1l6Ii.js","sources":["../src/helpers/dom/requestVideoFrameCallbackPolyfill.ts"],"sourcesContent":["// @ts-nocheck\r\n// https://github.com/ThaUnknown/rvfc-polyfill/blob/main/index.js\r\n\r\nif(!('requestVideoFrameCallback' in HTMLVideoElement.prototype) && 'getVideoPlaybackQuality' in HTMLVideoElement.prototype) {\r\n  HTMLVideoElement.prototype._rvfcpolyfillmap = {};\r\n  HTMLVideoElement.prototype.requestVideoFrameCallback = function(callback) {\r\n    const quality = this.getVideoPlaybackQuality();\r\n    const baseline = this.mozPresentedFrames || this.mozPaintedFrames || quality.totalVideoFrames - quality.droppedVideoFrames;\r\n\r\n    const check = (old, now) => {\r\n      const newquality = this.getVideoPlaybackQuality();\r\n      const presentedFrames = this.mozPresentedFrames || this.mozPaintedFrames || newquality.totalVideoFrames - newquality.droppedVideoFrames;\r\n      if(presentedFrames > baseline) {\r\n        const processingDuration = this.mozFrameDelay || (newquality.totalFrameDelay - quality.totalFrameDelay) || 0;\r\n        const timediff = now - old; // HighRes diff\r\n        callback(now, {\r\n          presentationTime: now + processingDuration * 1000,\r\n          expectedDisplayTime: now + timediff,\r\n          width: this.videoWidth,\r\n          height: this.videoHeight,\r\n          mediaTime: Math.max(0, this.currentTime || 0) + timediff / 1000,\r\n          presentedFrames,\r\n          processingDuration\r\n        });\r\n        delete this._rvfcpolyfillmap[handle];\r\n      } else {\r\n        this._rvfcpolyfillmap[handle] = requestAnimationFrame(newer => check(now, newer));\r\n      }\r\n    }\r\n\r\n    const handle = Date.now();\r\n    const now = performance.now();\r\n    this._rvfcpolyfillmap[handle] = requestAnimationFrame(newer => check(now, newer));\r\n    return handle; // spec says long, not doube, so can't re-use performance.now\r\n  };\r\n\r\n  HTMLVideoElement.prototype.cancelVideoFrameCallback = function(handle) {\r\n    cancelAnimationFrame(this._rvfcpolyfillmap[handle]);\r\n    delete this._rvfcpolyfillmap[handle];\r\n  };\r\n}\r\n\r\nexport {};\r\n"],"names":["callback","quality","baseline","check","old","now","newquality","presentedFrames","processingDuration","timediff","handle","newer"],"mappings":"AAGG,EAAE,8BAA+B,iBAAiB,YAAc,4BAA6B,iBAAiB,YAC9F,iBAAA,UAAU,iBAAmB,GAC7B,iBAAA,UAAU,0BAA4B,SAASA,EAAU,CAClE,MAAAC,EAAU,KAAK,0BACfC,EAAW,KAAK,oBAAsB,KAAK,kBAAoBD,EAAQ,iBAAmBA,EAAQ,mBAElGE,EAAQ,CAACC,EAAKC,IAAQ,CACpB,MAAAC,EAAa,KAAK,0BAClBC,EAAkB,KAAK,oBAAsB,KAAK,kBAAoBD,EAAW,iBAAmBA,EAAW,mBACrH,GAAGC,EAAkBL,EAAU,CAC7B,MAAMM,EAAqB,KAAK,eAAkBF,EAAW,gBAAkBL,EAAQ,iBAAoB,EACrGQ,EAAWJ,EAAMD,EACvBJ,EAASK,EAAK,CACZ,iBAAkBA,EAAMG,EAAqB,IAC7C,oBAAqBH,EAAMI,EAC3B,MAAO,KAAK,WACZ,OAAQ,KAAK,YACb,UAAW,KAAK,IAAI,EAAG,KAAK,aAAe,CAAC,EAAIA,EAAW,IAC3D,gBAAAF,EACA,mBAAAC,CAAA,CACD,EACM,OAAA,KAAK,iBAAiBE,CAAM,CAAA,MAE9B,KAAA,iBAAiBA,CAAM,EAAI,yBAA+BP,EAAME,EAAKM,CAAK,CAAC,CAClF,EAGID,EAAS,KAAK,MACdL,EAAM,YAAY,MACnB,YAAA,iBAAiBK,CAAM,EAAI,yBAA+BP,EAAME,EAAKM,CAAK,CAAC,EACzED,CAAA,EAGQ,iBAAA,UAAU,yBAA2B,SAASA,EAAQ,CAChD,qBAAA,KAAK,iBAAiBA,CAAM,CAAC,EAC3C,OAAA,KAAK,iBAAiBA,CAAM,CAAA"}